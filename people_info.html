<!-- 人物情報 -->
<?php
//データベース接続
require_once 'db_imfo.php';
$mysqli = new mysqli($db["host"],$db["user"],$db["pass"]);
	if ($mysqli->connect_errno) {
	print('<p>データベースへの接続に失敗しました。</p>' . $mysqli->connect_error);
	exit();
}
$mysqli->select_db("natori_web");
//文字化け対策
$mysqli->set_charset("utf8");

?>


<!DOCTYPE html>
<html lang="ja">
	<head>
		<meta charset="UTF-8">
		<title>Document</title>
	</head>
	<body>
		<!-- ジャンプする目標のためのid -->
		<p id="people_info">人物情報</p>
		
		<?php
		print $_POST['people'];
		print "<br>";
		?>


		<p id="people_info">発言した議案</p>

		<?php
		// 議員IDの取得
		$query = "SELECT * from people_info where name IN('"  .$_POST['people'].  "')";
		$result = $mysqli->query($query);
		if ($result = $mysqli->query($query)) {
		/* 連想配列を取得します */
			while ($row = $result->fetch_assoc()) {
			$people_id = $row["id_people_info"];
			}
		}



		// 議案IDの取得
		$i=0;
		$query_proxy = "SELECT DISTINCT `proxy_statement_id_proxy_statement` FROM `hatugen` WHERE `people_info_id_people_info` = "  .$people_id.  "";
		$result_proxy = $mysqli->query($query_proxy);
		if ($result_proxy = $mysqli->query($query_proxy)){
		/* 連想配列を取得します */
			
			while ($row_proxy = $result_proxy->fetch_assoc()) {
			/*
			printf ("%s\n", $row_proxy["proxy_statement_id_proxy_statement"]);
			*/

			$proxy_id[$i] = $row_proxy["proxy_statement_id_proxy_statement"];
			$i ++;
			}
		}
		


		// 発言した議案の取得
		$i=0;
		$k=0;
		if(isset($proxy_id)){
			foreach ($proxy_id as $proxy_id_2){
			$query_proxy_datail = "SELECT `detail` FROM `proxy_statement` WHERE	`id_proxy_statement` = "  .$proxy_id_2.  "";
			$result_proxy_detail = $mysqli->query($query_proxy_datail);
				if ($result_proxy_detail = $mysqli->query($query_proxy_datail)){
					while ($row_proxy_detail = $result_proxy_detail->fetch_assoc()) {
					printf ("【%s\n】", $row_proxy_detail["detail"]);
					print "<br>";
					}
			// 発言内容の取得
					$query_hatugen = "SELECT `detail` FROM `hatugen` WHERE `people_info_id_people_info` = "  .$people_id.  " AND `proxy_statement_id_proxy_statement` = "  .$proxy_id_2.  " ";
					$result_haturen = $mysqli->query($query_hatugen);
					if ($result_haturen = $mysqli->query($query_hatugen)){
						while ($row_hatugen = $result_haturen->fetch_assoc()) {
							printf ("%s\n", $row_hatugen["detail"]);
							print "<br>";
							print "<br>";



							// 答弁内容の取得
							$query_answer = "SELECT `id_hatugen` FROM `hatugen` WHERE `people_info_id_people_info` =  "  .$people_id.  " and `proxy_statement_id_proxy_statement` = "  .$proxy_id_2.  "";
							$result_answer = $mysqli->query($query_answer);
							if ($result_answer = $mysqli->query($query_answer)){
								while ($row_answer = $result_answer->fetch_assoc()) {
									$hatugen_id[$i] = $row_answer["id_hatugen"] +1;
									$hatugen_id[$i+1] = "stop";
									$i++;
									/*
								printf ("%s\n", $row_answer["id_hatugen"]);
								*/
							
								}
								// 答弁内容の表示。
								$query_answer_detail = "SELECT `detail` FROM `hatugen` WHERE `id_hatugen`="  .$hatugen_id[$k].  "";
								$result_answer_detail = $mysqli->query($query_answer_detail);

								if($hatugen_id[$k+1] != "stop"){
									if ($result_answer_detail = $mysqli->query($query_answer_detail)){
										while ($row_answer_detail = $result_answer_detail->fetch_assoc()) {
											printf ("【answer:】%s\n", $row_answer_detail["detail"]);
											print "<br>";
											print "<br>";
										}
									}
								}
								$k++;
								//配列の初期化
								$i=0;
								$hatugen_id = array();
							}
						}
					}
				}
			}
		}
		else{
			print("発言議案なし");
		}


  		/*
		発言内容の取得
		$query2 = "SELECT `detail` FROM `hatugen` WHERE `people_info_id_people_info` = "  .$people_id.  "";
		$result2 = $mysqli->query($query2);
		if ($result2 = $mysqli->query($query2)){
			while ($row2 = $result2->fetch_assoc()) {
			printf ("%s\n", $row2["detail"]);
			}
		}
		*/

			
		
	

		?>
	</body>
</html>